<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player de M√∫sica</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #121212;
      color: #fff;
    }
    header {
      padding: 1rem;
      background: #1c1c1c;
      text-align: center;
      font-size: 1.2rem;
      font-weight: bold;
    }
    main {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
    }
    .highlight {
      position: relative;
      width: 100%;
      max-width: 900px;
      height: 400px;
      margin: 0 auto;
      background: #000;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .highlight video,
    .highlight img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #toggleVideoBtn, #fullscreenBtn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      margin-left: 5px;
      padding: 6px 10px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #toggleVideoBtn {
      right: 80px;
    }
    .player {
      max-width: 900px;
      margin: 0 auto;
      background: #1c1c1c;
      padding: 1rem;
      border-radius: 12px;
    }
    .controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .progress {
      flex: 1;
      height: 6px;
      background: #333;
      border-radius: 3px;
      cursor: pointer;
      position: relative;
    }
    .progress div {
      height: 100%;
      width: 0%;
      background: #1db954;
      border-radius: 3px;
    }
    .albums, .playlists {
      max-width: 900px;
      margin: 0 auto;
    }
    .albums h2, .playlists h2 {
      margin-bottom: 0.5rem;
    }
    .album, .playlist {
      display: inline-block;
      width: 160px;
      margin: 0.5rem;
      cursor: pointer;
    }
    .album img, .playlist img {
      width: 100%;
      border-radius: 12px;
    }
    .tracklist {
      margin-top: 0.5rem;
      padding-left: 1rem;
      font-size: 0.9rem;
    }
    .tracklist div {
      cursor: pointer;
      padding: 4px 0;
    }
    .tracklist div.active {
      color: #1db954;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <header>üé∂ Meu Player de M√∫sica</header>
  <main>
    <section class="highlight">
      <video id="highlightVideo" playsinline></video>
      <img id="artistImage" style="display:none; width:100%; height:100%; object-fit:cover;" alt="Artista"/>
      <button id="toggleVideoBtn">üé¨ Ver Clipe</button>
      <button id="fullscreenBtn">‚õ∂</button>
    </section>

    <section class="player">
      <div id="nowPlaying">Nenhuma faixa selecionada</div>
      <div class="controls">
        <button id="prevBtn">‚èÆÔ∏è</button>
        <button id="playBtn">‚ñ∂Ô∏è</button>
        <button id="nextBtn">‚è≠Ô∏è</button>
        <div class="progress" id="progressBar">
          <div id="progressFill"></div>
        </div>
        <div id="timeDisplay">0:00 / 0:00</div>
      </div>
    </section>

    <section class="albums">
      <h2>√Ålbuns</h2>
      <div id="albumsContainer"></div>
    </section>

    <section class="playlists">
      <h2>Playlists</h2>
      <div id="playlistsContainer"></div>
    </section>
  </main>

  <script>
    let musicData;
    let currentPlaylist = [];
    let currentIndex = 0;
    let currentMedia = null;
    let forceAudioOnly = false;
    let albumCover = "";

    const videoEl = document.getElementById("highlightVideo");
    const artistImage = document.getElementById("artistImage");
    const audioEl = new Audio();
    const playBtn = document.getElementById("playBtn");
    const nowPlayingEl = document.getElementById("nowPlaying");
    const progressBar = document.getElementById("progressBar");
    const progressFill = document.getElementById("progressFill");
    const timeDisplay = document.getElementById("timeDisplay");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const toggleVideoBtn = document.getElementById("toggleVideoBtn");
    const fullscreenBtn = document.getElementById("fullscreenBtn");

    function loadJSON() {
      fetch("musicas.json")
        .then(r => r.json())
        .then(data => {
          musicData = data;
          renderAlbums();
          renderPlaylists();
        });
    }

    function renderAlbums() {
      const container = document.getElementById("albumsContainer");
      container.innerHTML = "";
      musicData.albuns.forEach((alb, i) => {
        const div = document.createElement("div");
        div.className = "album";
        div.innerHTML = `<img src="${alb.capa}" alt="${alb.titulo}"><div>${alb.titulo}</div>`;
        div.addEventListener("click", () => {
          currentPlaylist = alb.faixas;
          currentIndex = 0;
          albumCover = alb.capa;
          playCurrent();
          renderTracklist(alb.faixas);
        });
        container.appendChild(div);
      });
    }

    function renderTracklist(faixas) {
      const container = document.createElement("div");
      container.className = "tracklist";
      faixas.forEach((f, idx) => {
        const item = document.createElement("div");
        item.textContent = `${f.titulo} ‚Äî ${f.artista}`;
        item.addEventListener("click", () => {
          currentIndex = idx;
          playCurrent(true);
        });
        container.appendChild(item);
      });
      document.getElementById("albumsContainer").appendChild(container);
    }

    function renderPlaylists() {
      const container = document.getElementById("playlistsContainer");
      container.innerHTML = "";
      musicData.playlists.forEach(pl => {
        const div = document.createElement("div");
        div.className = "playlist";
        div.innerHTML = `<img src="${pl.capa}" alt="${pl.nome}"><div>${pl.nome}</div>`;
        div.addEventListener("click", () => {
          currentPlaylist = pl.faixas;
          currentIndex = 0;
          albumCover = pl.capa;
          playCurrent();
        });
        container.appendChild(div);
      });
    }

    function playCurrent(fromUserGesture = false) {
      if (!currentPlaylist.length) return;

      const m = currentPlaylist[currentIndex];
      const useVideo = !!m.video && !forceAudioOnly;

      videoEl.style.display = "none";
      artistImage.style.display = "none";

      if (useVideo) {
        videoEl.src = m.video;
        videoEl.style.display = "block";
        audioEl.pause();
        audioEl.src = "";
        currentMedia = videoEl;

        toggleVideoBtn.style.display = "block";
        toggleVideoBtn.textContent = "üéµ S√≥ √Åudio";
      } else {
        audioEl.src = m.audio;
        videoEl.pause();
        videoEl.src = "";

        artistImage.src = m.fotoArtista || musicData.placeholderArtista || "";
        artistImage.style.display = "block";

        currentMedia = audioEl;
        toggleVideoBtn.style.display = m.video ? "block" : "none";
        toggleVideoBtn.textContent = "üé¨ Ver Clipe";
      }

      nowPlayingEl.textContent = `${m.titulo} ‚Äî ${m.artista}`;
      playBtn.textContent = "‚è∏Ô∏è";

      const p = currentMedia.play();
      if (p && typeof p.catch === "function") {
        p.catch(() => { playBtn.textContent = "‚ñ∂Ô∏è"; });
      }
    }

    playBtn.addEventListener("click", () => {
      if (!currentMedia) return;
      if (currentMedia.paused) {
        currentMedia.play();
        playBtn.textContent = "‚è∏Ô∏è";
      } else {
        currentMedia.pause();
        playBtn.textContent = "‚ñ∂Ô∏è";
      }
    });

    prevBtn.addEventListener("click", () => {
      if (currentIndex > 0) currentIndex--;
      playCurrent();
    });

    nextBtn.addEventListener("click", () => {
      if (currentIndex < currentPlaylist.length - 1) currentIndex++;
      playCurrent();
    });

    toggleVideoBtn.addEventListener("click", () => {
      forceAudioOnly = !forceAudioOnly;
      playCurrent(true);
    });

    fullscreenBtn.addEventListener("click", () => {
      if (videoEl.requestFullscreen) videoEl.requestFullscreen();
    });

    setInterval(() => {
      if (!currentMedia) return;
      const cur = currentMedia.currentTime || 0;
      const dur = currentMedia.duration || 0;
      progressFill.style.width = (dur ? (cur / dur) * 100 : 0) + "%";
      timeDisplay.textContent = formatTime(cur) + " / " + formatTime(dur);
    }, 500);

    function formatTime(s) {
      if (!s) return "0:00";
      const m = Math.floor(s / 60);
      const sec = Math.floor(s % 60).toString().padStart(2, "0");
      return m + ":" + sec;
    }

    loadJSON();
  </script>
</body>
</html>
